## Process & Thread

### Process
- 프로세스는 프로그램의 실제 실행을 의미하며 프로그램 파일을 실행함으로써 프로그램 데이터들이 메모리에 올라와 **CPU를 할당받고 명령을 수행하고 있는 상태이다.**
- 프로세스는 운영체제로부터 자원을 할당받은 최소 작업 단위이다.

### Process의 구조
프로세스는 4가지 영역으로 이루어져 있다.

- Stack
  - 함수 안에서 선언된 지역변수, 매개변수, 리턴값등이 저장된다.
  - 함수의 호출과 함께 할당되며 함수의 호출이 완료도면 소멸된다.
- Heap
  - 사용자에 의해 메모리 공간에 동적으로 할당되고 해제된다.
  - 메모리의 낮은 주소에서 높은 주소의 방향으로 할당된다.
- Data
  - 코드가 실행되면서 사용되는 전역변수, static 변수 등
  - 프로그램 시작과 함께 할당되며 프로그램이 종료되면 소멸된다.
- Code
  - 사용자가 직접 작성한 코드들
  - CPU는 코드 영역에 작성된 명령어를 하나씩 가져가 처리한다.

Stack, Heap 영역은 런타임 시점에 메모리가 동적으로 변한다는 특징이 있다.  

메모리가 동적으로 계속 늘어나기 때문에 관리가 필요한 공간. (StackOverflow, OutOfMemory 에러가 발생하는 이유가 해당 공간이 부족하기 때문)

### Process의 특징
- 운영체제는 프로세스마다 각각 **독립된 메모리 영역을** Stack/Heap/Data/Code 의 형식으로 할당해 준다.
- 독립된 메모리 영역을 할당해 주기 때문에 프로세스 간 영향을 받지 않고 독립적인 작업을 수행할 수 있다.

## Thread
- 스레드는 프로세스가 운영체제로부터 할당 받은 자원을 이용하는 실행단위 또는 흐름의 단위로서 하나의 프로세스는 반드시 하나 이상의 스레드를 갖는다.
- 프로세스 내에서 각 필요한 Stack만 할당받고 Code, Data, Heap 영역은 공유해서 각 스레드가 공유한다.
- 스레드 간 메모리 스택 영역에 접근할 수 없으므로 스레드는 독립적인 실행 흐름을 가질 수 있게 되어 독립적인 함수 호출이 가능해 진다.

### Thread와 CPU의 관계
- 스레드는 운영체제의 스케줄러에 의해 관리되는 CPU의 최소 실행 단위를 의미한다.
- 스케줄러의 알고리즘에 따라 프로세스에 속한 한개의 스레드가 선점되어 CPU 에 할당된다. 
  - CPU는 동시에 2개의 스레드를 실행시킬 수 없다. -> 반드시 하나의 CPU는 하나의 스레드만 선점하여 실행한다.
- 스레드 간 선점이 일어날 때 CPU의 실행 흐름이 전환되는 컨텍스트 스위칭이 발생한다.

### Process vs Thread
#### Process
- 여러 자식 프로세스 중 하나에 문제가 발생하여도 해당 자식 프로세스만 죽고 다른 프로세스에 영향을 미치지 않는다. ( = 프로그램 안정성 확보)
- 프로세스 간 전환(컨텍스트 스위칭) 시 레지스터, 캐시메모리 초기화 등 무거운 작업으로 인한 시간적인 비용이 많이 발생한다.
- 프로세스 간 통신 기법이 어렵고 복잡해서 통신으로 인한 오버헤드가 크다.
- 프로세스 생성 시 독립적으로 메모리가 할당되기 때문에 리소스 비용이 크다.

#### Thread
- 여러 개의 스레드 중 하나에 문제가 발생하면 전체 프로세스에 영향을 미친다.
- 프로세스의 메모리 영역을 공유 하기 때문에 컨텍스트 스위칭 시간이 적고 리소스를 효육적으로 사용한다.
- 스레드 간 통신비용이 적어 통신으로 인한 오버헤드가 작다.
- **스레드 간 공유 메모리 영역의 동시 접근으로 인한 동기화 문제가 발생한다.**
- 하나의 스레드에서 오류가 발생할 경우 프로세스 자체가 종료될 수 있다.
